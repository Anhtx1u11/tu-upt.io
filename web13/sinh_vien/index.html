<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>UPT Mini App</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary:#0ea5e9; /* sky-500 */
      --primary-600:#0284c7;
      --bg:#f6f7fb;
      --text:#0f172a; /* slate-900 */
      --muted:#64748b; /* slate-500 */
      --card:#ffffff;
      --card-2:#f8fafc;
      --line:#e6eef6;
      --shadow:0 12px 40px rgba(15,23,42,.06);
      --radius:18px;
      --radius-lg:22px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"}
    img{max-width:100%;display:block}
    .app{max-width:980px;margin:0 auto;min-height:100%;position:relative;padding-bottom:84px}

    /* Header */
    .header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(180%) blur(8px);background:linear-gradient(180deg,#f0f9ff,rgba(240,249,255,.8));border-bottom:1px solid var(--line)}
    .header-inner{display:flex;gap:12px;align-items:center;padding:12px 16px}
    .logo{width:48px;height:48px;border-radius:14px;object-fit:cover;border:1px solid var(--line);background:#fff}
    .brand{display:flex;flex-direction:column}
    .brand .title{font-weight:800;line-height:1.1;font-size:18px;letter-spacing:.2px}
    .brand .subtitle{font-size:12px;color:var(--muted)}
    .badges{margin-left:auto;display:flex;align-items:center;gap:10px}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:7px 12px;border-radius:999px;background:#e6f4ff;color:#0369a1;font-size:12px;border:1px solid var(--line)}

    /* Hero / Greeting */
    .hero{margin:12px 16px 0;background:linear-gradient(135deg,#e0f2fe, #f0f9ff);border-radius:var(--radius-lg);padding:18px 18px;box-shadow:var(--shadow);display:flex;align-items:center;gap:16px;overflow:hidden;position:relative}
    .hero .hello{font-weight:700;font-size:18px}
    .hero .subtitle{font-size:13px;color:var(--muted)}
    .hero .right-chip{margin-left:auto}

    /* Carousel */
    .carousel{margin:14px 16px;border-radius:24px;overflow:hidden;position:relative;box-shadow:var(--shadow)}
    .slides{display:flex;transition:transform .6s cubic-bezier(.22,.61,.36,1);}
    .slide{min-width:100%;height:220px;background:#cbd5e1;display:flex;align-items:center;justify-content:center;position:relative}
    .slide img{width:100%;height:100%;object-fit:cover}
    .slide::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.0) 60%, rgba(0,0,0,.25));}
    .slide-caption{position:absolute;left:16px;bottom:12px;color:#fff;font-weight:600;text-shadow:0 2px 10px rgba(0,0,0,.25)}
    .dots{position:absolute;inset:auto 0 10px 0;display:flex;gap:6px;justify-content:center}
    .dot{width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,.55)}
    .dot.active{background:#fff}

    /* Section title */
    .section-title{margin:14px 16px 8px;font-weight:800;letter-spacing:.2px}

    /* Feature grid */
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:0 16px 16px}
    @media(min-width:760px){.grid{grid-template-columns:repeat(4,1fr)}}
    .card{background:var(--card);border-radius:20px;padding:16px 14px;box-shadow:var(--shadow);display:flex;align-items:center;gap:12px;min-height:88px;position:relative;isolation:isolate;border:1px solid var(--line);cursor:pointer;transition:transform .18s ease, box-shadow .18s ease}
    .card:hover{transform:translateY(-2px);box-shadow:0 16px 44px rgba(2,132,199,.18)}
    .icon{width:48px;height:48px;border-radius:14px;display:grid;place-items:center;background:#eff6ff;border:1px solid var(--line);font-size:22px}
    .name{font-size:15px;font-weight:700}
    .desc{font-size:12px;color:var(--muted);margin-top:4px}

    /* Main view container */
    .view{margin:8px 16px 16px;background:var(--card);border-radius:24px;padding:18px;box-shadow:var(--shadow);border:1px solid var(--line)}
    .view.hidden{display:none}

    /* Tabs inside view (for Ngành đào tạo) */
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .tab{padding:8px 12px;border-radius:999px;background:#f1f5f9;border:1px solid var(--line);font-size:13px;cursor:pointer}
    .tab.active{background:#e0f2fe;border-color:#bae6fd;color:#075985;font-weight:600}

    /* Cards inside views */
    .programs{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:640px){.programs{grid-template-columns:1fr 1fr}}
    .p-card{border:1px solid var(--line);border-radius:18px;padding:14px;background:var(--card-2)}
    .p-title{font-weight:700}
    .p-meta{font-size:12px;color:var(--muted);margin:6px 0}
    .p-actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{all:unset;display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;background:#0ea5e9;color:white;cursor:pointer;font-size:13px}
    .btn.ghost{background:#eef6ff;color:#0369a1;border:1px solid #cfe8ff}

    /* Contact directory */
    .directory{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:640px){.directory{grid-template-columns:1fr 1fr}}
    .contact{border:1px solid var(--line);border-radius:16px;padding:12px;background:var(--card-2)}
    .contact .c-name{font-weight:700}
    .contact .c-meta{font-size:13px;color:var(--muted)}

    /* Events */
    .events{display:grid;grid-template-columns:1fr;gap:12px}
    .event{display:flex;gap:12px;border:1px solid var(--line);border-radius:16px;padding:12px;background:var(--card-2)}
    .event .date{min-width:64px;text-align:center;border-right:1px dashed var(--line);padding-right:12px}
    .event .date .d1{font-size:22px;font-weight:800}
    .event .date .d2{font-size:12px;color:var(--muted)}
    .event .body{flex:1}
    .event .title{font-weight:700;margin-bottom:6px}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#f1f5f9;border:1px solid var(--line);font-size:12px}

    /* Personal */
    .profile{display:grid;grid-template-columns:80px 1fr;gap:12px;align-items:center}
    .avatar{width:80px;height:80px;border-radius:20px;background:#e2e8f0;display:grid;place-items:center;font-size:28px;border:1px solid var(--line);overflow:hidden;}
    .profile .meta{color:var(--muted);font-size:13px}
    .stat-row{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
    .stat{background:#f8fafc;border:1px solid var(--line);border-radius:14px;padding:12px;text-align:center}
    .stat .k{font-size:18px;font-weight:800}
    .stat .l{font-size:12px;color:var(--muted)}

    /* Bottom Navigation */
    .nav{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--line);box-shadow:0 -10px 30px rgba(15,23,42,.06)}
    .nav .bar{max-width:980px;margin:0 auto;display:grid;grid-template-columns:repeat(5,1fr)}
    .nav a{display:flex;flex-direction:column;align-items:center;gap:4px;padding:10px 0;text-decoration:none;color:#475569;font-size:11px}
    .nav a.active{color:var(--primary);font-weight:700}
    .nav svg{width:22px;height:22px}

    /* Floating chat button */
    .fab{position:fixed;right:18px;bottom:106px;width:56px;height:56px;border-radius:999px;background:var(--primary);color:#fff;display:grid;place-items:center;box-shadow:0 18px 40px rgba(14,165,233,.5);border:none}

    /* Toast */
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:180px;background:#0f172acc;color:#fff;padding:10px 14px;border-radius:10px;font-size:13px;opacity:0;pointer-events:none;transition:opacity .3s ease}
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header class="header">
      <div class="header-inner">
        <img class="logo" style="border-radius: 50px;" onclick="window.location.href ='https://painfully-awaited-airedale.ngrok-free.app/qlsv_upt'" src="https://upt.edu.vn/wp-content/uploads/2020/05/logo-UPT-768x768.png" alt="logo"/>
        <div class="brand">
          <div class="title">TRƯỜNG ĐẠI HỌC Phan Thiết</div>
          <div class="subtitle">UPT UNIVERSITY</div>
        </div>
        <div class="badges">
          <div class="badge" id="statusBadge">Khách</div>
        </div>
      </div>
    </header>

    <section class="hero">
      <div>
        <div class="hello" id="helloText">Chào buổi sáng!</div>
        <div class="subtitle" id="userName">Khách !</div>
      </div>
      <div class="badge right-chip">Mini App UPT</div>
    </section>
    <section class="carousel" aria-label="Ảnh nổi bật">
      <div class="slides" id="slides">
        <div class="slide">
          <img src="https://upt.edu.vn/wp-content/uploads/2025/08/CV-XetHocBa-CoHoiCuoi-Zalo-02-scaled.jpg" alt="Hội nghị"/>
          <div class="slide-caption">Cơ hội cuối xét học bạ</div>
        </div>
         <div class="slide">
          <div class="slide">
          <img src="https://upt.edu.vn/wp-content/uploads/2025/08/QuocKhanh-02.09.2025-A80-Zalo-01-scaled.jpg" alt="Sinh viên"/>
          <div class="slide-caption"></div>
        </div>
        <div class="slide">
          <img src="https://images.unsplash.com/photo-1523580846011-d3a5bc25702b?q=80&w=1600&auto=format&fit=crop" alt="Sinh viên"/>
          <div class="slide-caption">Cuộc sống sinh viên năng động</div>
        </div>
        <div class="slide">
          <img src="https://upt.edu.vn/wp-content/uploads/2025/01/TS-ThacSi-2025-01-2048x1075.jpg" alt="Khuôn viên"/>
          <div class="slide-caption">Tuyển sinh Thạc sĩ 2025</div>
        </div>
      </div>
      <div class="dots" id="dots">
        <span class="dot active"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      </div>
    </section>

    <h3 class="section-title">Danh mục</h3>
    <section class="grid">
      <div onclick="window.location.href='https://painfully-awaited-airedale.ngrok-free.app/qlsv_upt/ddgps/profile/'" class="card" role="button" tabindex="0">
        <div id = "ddgps" class="icon" aria-hidden="true">📄</div>
        <div>
          <div class="name">Điểm Danh</div>
          <div class="desc">Điểm Danh Nhanh && Chống Gian Lận</div>
        </div>
      </div>

      <div class="card" id ="bot-zalo" onclick="clickbotzalo()" role="button" tabindex="0">
        <div class="icon" aria-hidden="true">🤖</div>
        <div>
          <div class="name">Bot Zalo</div>
          <div class="desc">Nhắc Lịch Học & Lấy TKB</div>
        </div>
      </div>

       <div onclick="window.location.href='https://pdt.upt.edu.vn/chuan-dau-ra-dai-hoc-phan-thiet'"  class="card"ole="button" tabindex="0">
        <div onclick="window.location.href='https://pdt.upt.edu.vn/chuan-dau-ra-dai-hoc-phan-thiet'" class="icon" aria-hidden="true">🔺</div>
        <div>
          <div class="name">Chuẩn Đầu Ra</div>
          <div class="desc">Xem Chuẩn Đầu Ra Các Ngành</div>
        </div>
      </div>

      <div onclick="window.location.href='https://pdt.upt.edu.vn/chuong-trinh-dao-tao.html'" class="card" id ="bot-zalo" onclick="clickbotzalo()" role="button" tabindex="0">
        <div class="icon" aria-hidden="true">🔈</div>
        <div>
          <div class="name">Chương Trình Đào Tạo</div>
          <div class="desc">Xem Chương Trình Đào Tạo</div>
        </div>
      </div>

      <div onclick="window.location.href='https://upt.edu.vn/chuyen-muc/tuyen-sinh-dai-hoc/'" class="card" id ="bot-zalo" onclick="clickbotzalo()" role="button" tabindex="0">
        <div class="icon" aria-hidden="true">📬</div>
        <div>
          <div class="name">Góc Truyền Thông</div>
          <div class="desc">Xem Góc Truyền Thông</div>
        </div>
      </div>

      <div onclick="window.location.href='https://pdt.upt.edu.vn/goc-sinh-vien/mau-bieu-sinh-vien.html'" class="card" id ="bot-zalo" onclick="clickbotzalo()" role="button" tabindex="0">
        <div class="icon" aria-hidden="true">📝</div>
        <div>
          <div class="name">Mẫu Biểu Sinh Viên</div>
          <div class="desc">Xem Mẫu Biểu Sinh Viên</div>
        </div>
      </div>

       <div onclick="window.location.href='https://upt.edu.vn/15nam-upt/mobile/index.html'" class="card" id ="bot-zalo" onclick="clickbotzalo()" role="button" tabindex="0">
        <div class="icon" aria-hidden="true"><img style=" border-radius: 20px;" src="https://anhtu1.id.vn/blog/img/img5.jpg"></div>
        <div>
          <div class="name">15 Năm UPT</div>
          <div class="desc">Xem Tạp Chí</div>
        </div>
      </div>


    </section>

    <section id="view-thu-tuc" class="view hidden">
      <h3>Thủ tục sinh viên</h3>
      <p class="subtitle">Các quy trình phổ biến và biểu mẫu tải nhanh.</p>
      <div class="programs">
        <div class="p-card">
          <div class="p-title">Xác nhận sinh viên</div>
          <div class="p-meta">Thời gian xử lý: 1–2 ngày làm việc</div>
          <div class="p-actions">
            <button class="btn" onclick="toast('Đã mở biểu mẫu xác nhận')">Mở biểu mẫu</button>
            <button class="btn ghost" onclick="toast('Đã tải PDF hướng dẫn')">Tải hướng dẫn</button>
          </div>
        </div>
        <div class="p-card">
          <div class="p-title">Xin hoãn/miễn học phí</div>
          <div class="p-meta">Yêu cầu chứng từ kèm theo</div>
          <div class="p-actions">
            <button class="btn" onclick="toast('Đã mở mẫu hoãn/miễn học phí')">Mở mẫu</button>
            <button class="btn ghost" onclick="toast('Đang tải hướng dẫn')">Hướng dẫn</button>
          </div>
        </div>
        <div class="p-card">
          <div class="p-title">Cấp lại thẻ sinh viên</div>
          <div class="p-meta">Phí 50.000đ – nhận tại Phòng CTSV</div>
          <div class="p-actions">
            <button class="btn" onclick="toast('Gửi yêu cầu cấp lại thẻ')">Gửi yêu cầu</button>
            <button class="btn ghost" onclick="toast('Xem quy định thẻ SV')">Quy định</button>
          </div>
        </div>
      </div>
    </section>

    <section id="view-nganh-dao-tao" class="view hidden">
      <h3>Ngành đào tạo</h3>
      <div class="tabs" id="majorTabs"></div>
      <div class="programs" id="majorList"></div>
    </section>

    <section id="view-diem-tuyen-sinh" class="view hidden">
      <h3>Điểm tuyển sinh</h3>
      <p class="subtitle">Tra cứu điểm chuẩn & tổ hợp xét tuyển.</p>
      <div class="programs" id="scoreList"></div>
    </section>

    <section id="view-lich-hoc" class="view hidden">
      <h3>Lịch học</h3>
      <p class="subtitle">Đăng nhập để xem thời khóa biểu cá nhân.</p>
      <div class="p-card">
        <div class="p-title">Thời khóa biểu tuần này</div>
        <div id="timetable">Vui lòng đăng nhập MSSV tại mục <b>Cá nhân</b>.</div>
      </div>
    </section>

    <section id="view-su-kien" class="view hidden">
      <h3>Sự kiện</h3>
      <div class="events" id="eventList"></div>
    </section>

    <section id="view-lien-he" class="view hidden">
      <h3>Liên hệ</h3>
      <p class="subtitle">Danh bạ phòng ban & các kênh hỗ trợ.</p>
      <div class="directory" id="directory"></div>
    </section>

    <section id="view-ca-nhan" class="view hidden">
      <h3>Trang cá nhân</h3>
      <div class="profile">
        <div class="avatar" id="avatar">👤</div>
        <div>
          <div class="p-title" id="pName">Khách</div>
          <div class="meta" id="pMeta">Chưa đăng nhập · Nhấn “Đăng nhập MSSV”</div>
          <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
            
          </div>
        </div>
      </div>
      <div class="stat-row">
        <div class="stat"><div class="k" id="sCredit">—</div><div class="l">Số tín chỉ</div></div>
        <div class="stat"><div class="k" id="sGPA">—</div><div class="l">GPA tạm tính</div></div>
        <div class="stat"><div class="k" id="sNotif">0</div><div class="l">Thông báo</div></div>
      </div>
    </section>

    <nav class="nav" role="navigation" aria-label="Điều hướng">
      <div class="bar">
        <a href="#home" class="active" onclick="switchTab(this,'home')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12l9-9 9 9"/><path d="M9 21V9h6v12"/></svg>
          Home
        </a>
        <a href="#majors" onclick="switchTab(this,'nganh-dao-tao')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12l-10 7L2 12l10-7 10 7z"/><path d="M2 12l10 7 10-7"/><path d="M2 12l10-7 10 7"/></svg>
          T. tin ngành
        </a>
        <a href="#contact" onclick="switchTab(this,'lien-he')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
          Liên hệ
        </a>
        <a href="#events" onclick="switchTab(this,'su-kien')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="14" rx="2"/><path d="M8 22h8"/></svg>
          Sự kiện
        </a>
        <a href="#me" id="personalBtn" onclick="switchTab(this,'ca-nhan')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          Cá nhân
        </a>
      </div>
    </nav>
  </div>

    
  <script>
    document.getElementById("ddgps").onclick = function(){
      window.open("https://fox-kind-monthly.ngrok-free.app")
    }

  </script>
  <script>
// Nạp danh sách sinh viên từ API
fetch("https://painfully-awaited-airedale.ngrok-free.app/qlsv_upt/api/api_get_all_students.php") // <--- THAY ĐỔI DUY NHẤT Ở ĐÂY
  .then(response => response.json())
  .then(data => {
    console.log("Dữ liệu sinh viên từ Database:", data);

    // Code chuẩn hoá dữ liệu vẫn giữ nguyên vì API đã trả về đúng định dạng
    window.studentList = (Array.isArray(data) ? data : []).map(sv => ({
        mssv:    sv.mssv,
        name:    sv.name,
        major:   sv.major,
        credits: sv.credits ?? null,
        gpa:     sv.gpa ?? null
    }));
  })
  .catch(error => {
      console.error('Lỗi khi tải dữ liệu từ API:', error);
      alert('Không thể kết nối đến máy chủ để lấy danh sách sinh viên.');
  });
//...
</script>


  <div class="toast" id="toast"></div>

  <script>
    /* ===== Greeting based on time ===== */
    const h = new Date().getHours();
    const hello = document.getElementById('helloText');
    hello.textContent = h < 12 ? 'Chào buổi sáng!' : (h < 18 ? 'Chào buổi Trưa!' : 'Chào buổi tối!');

    /* ===== Simple carousel autoplay ===== */
    const slides = document.getElementById('slides');
    const dots = Array.from(document.getElementById('dots').children);
    let idx = 0; let carouselTimer;
    function go(i){
      idx = (i + dots.length) % dots.length;
      slides.style.transform = `translateX(-${idx*100}%)`;
      dots.forEach((d,di)=>d.classList.toggle('active', di===idx));
    }
    function startCarousel(){
      clearInterval(carouselTimer);
      carouselTimer = setInterval(()=>go(idx+1), 3500);
    }
    startCarousel();

    /* ===== Data mocks (majors, scores, directory, events) ===== */
    const MAJORS = {
      'Kinh tế - Quản trị': [
        { code:'QTKD', name:'Quản trị Kinh doanh', duration:'4 năm', degree:'Cử nhân', link:'#' },
        { code:'MA', name:'Marketing', duration:'4 năm', degree:'Cử nhân', link:'#' },
        { code:'TA', name:'Tài chính - Ngân hàng', duration:'4 năm', degree:'Cử nhân', link:'#' },
      ],
      'Du lịch - Nhà hàng - KS': [
        { code:'DL', name:'Quản trị Dịch vụ Du lịch & Lữ hành', duration:'4 năm', degree:'Cử nhân', link:'#' },
        { code:'KS', name:'Quản trị Khách sạn', duration:'4 năm', degree:'Cử nhân', link:'#' },
      ],
      'Kỹ thuật - CNTT': [
        { code:'CNTT', name:'Công nghệ Thông tin', duration:'4 năm', degree:'Cử nhân', link:'#' },
        { code:'KTPM', name:'Kỹ thuật Phần mềm', duration:'4 năm', degree:'Kỹ sư', link:'#' },
      ]
    };

    const SCORES = [
      { major:'Công nghệ Thông tin', block:'A00, A01, D01', score:18.5 },
      { major:'Quản trị Kinh doanh', block:'A00, A01, D01', score:19.0 },
      { major:'Marketing', block:'A00, A01, D01', score:19.5 },
      { major:'Quản trị Khách sạn', block:'C00, D01', score:18.0 },
    ];

    const DIRECTORY = [
      { name:'Phòng Đào tạo', phone:'0252 3825 999', email:'daotao@upt.edu.vn', addr:'225 Nguyễn Thông, Phan Thiết' },
      { name:'Phòng CTSV', phone:'0252 3825 777', email:'ctsv@upt.edu.vn', addr:'225 Nguyễn Thông, Phan Thiết' },
      { name:'Trung tâm Tuyển sinh', phone:'0252 3825 333', email:'tuyensinh@upt.edu.vn', addr:'225 Nguyễn Thông, Phan Thiết' },
      { name:'Phòng Công nghệ thông tin', phone:'0252 3825 111', email:'it@upt.edu.vn', addr:'225 Nguyễn Thông, Phan Thiết' },
    ];

    const EVENTS = [
      { date:'16', month:'08/2025', title:'Tuần sinh hoạt công dân đầu khóa', type:'Hội thảo', location:'Hội trường A', time:'08:00' },
      { date:'20', month:'08/2025', title:'Ngày hội Câu lạc bộ Sinh viên', type:'Sự kiện', location:'Sảnh chính', time:'15:00' },
      { date:'05', month:'09/2025', title:'Khai giảng năm học 2025–2026', type:'Lễ', location:'Sân trường', time:'07:30' },
    ];

    /* ===== Render helpers ===== */
    const majorTabs = document.getElementById('majorTabs');
    const majorList = document.getElementById('majorList');

    function renderMajors(){
      majorTabs.innerHTML = '';
      majorList.innerHTML = '';
      const groups = Object.keys(MAJORS);
      groups.forEach((g, i)=>{
        const el = document.createElement('button');
        el.className = 'tab' + (i===0?' active':'');
        el.textContent = g;
        el.onclick = ()=>{ document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); el.classList.add('active'); renderMajorGroup(g); };
        majorTabs.appendChild(el);
      });
      if(groups.length) renderMajorGroup(groups[0]);
    }

    function renderMajorGroup(group){
      majorList.innerHTML = '';
      MAJORS[group].forEach(m=>{
        const div = document.createElement('div');
        div.className = 'p-card';
        div.innerHTML = `
          <div class="p-title">${m.name} <span style="color:var(--muted);font-weight:500">(${m.code})</span></div>
          <div class="p-meta">Thời gian: ${m.duration} · Văn bằng: ${m.degree}</div>
          <div class="p-actions">
            <button class="btn" onclick="toast('Mở đề cương: ${m.name}')">Đề cương</button>
            <button class="btn ghost" onclick="toast('Tư vấn: ${m.name}')">Đăng ký tư vấn</button>
          </div>
        `;
        majorList.appendChild(div);
      })
    }

    function renderScores(){
      const wrap = document.getElementById('scoreList');
      wrap.innerHTML = '';
      SCORES.forEach(s=>{
        const div = document.createElement('div');
        div.className = 'p-card';
        div.innerHTML = `
          <div class="p-title">${s.major}</div>
          <div class="p-meta">Tổ hợp: ${s.block}</div>
          <div class="p-actions"><span class="chip">Điểm chuẩn dự kiến: <b style="margin-left:6px">${s.score}</b></span></div>
        `;
        wrap.appendChild(div);
      })
    }

    function renderDirectory(){
      const wrap = document.getElementById('directory');
      wrap.innerHTML = '';
      DIRECTORY.forEach(d=>{
        const div = document.createElement('div');
        div.className = 'contact';
        div.innerHTML = `
          <div class="c-name">${d.name}</div>
          <div class="c-meta">📞 ${d.phone} · ✉️ ${d.email}</div>
          <div class="c-meta">📍 ${d.addr}</div>
          <div style="margin-top:8px"><button class="btn ghost" onclick="toast('Đang gọi ${d.phone}')">Gọi</button> <button class="btn ghost" onclick="toast('Soạn email đến ${d.email}')">Email</button></div>
        `;
        wrap.appendChild(div);
      })
    }

    function renderEvents(){
      const wrap = document.getElementById('eventList');
      wrap.innerHTML='';
      EVENTS.forEach(e=>{
        const div = document.createElement('div');
        div.className = 'event';
        div.innerHTML = `
          <div class="date"><div class="d1">${e.date}</div><div class="d2">${e.month}</div></div>
          <div class="body">
            <div class="title">${e.title}</div>
            <div class="c-meta">⏰ ${e.time} · 📍 ${e.location}</div>
            <div style="margin-top:8px"><span class="chip">${e.type}</span> <button class="btn ghost" style="margin-left:6px" onclick="toast('Đã lưu lịch: ${e.title}')">Lưu lịch</button></div>
          </div>
        `;
        wrap.appendChild(div);
      })
    }

    /* ===== Router-like view switching ===== */
    const VIEWS = ['thu-tuc','nganh-dao-tao','diem-tuyen-sinh','lich-hoc','su-kien','lien-he','ca-nhan'];
    function openFeature(key){
      VIEWS.forEach(v=>document.getElementById('view-'+v).classList.add('hidden'));
      const el = document.getElementById('view-'+key);
      if(el){ el.classList.remove('hidden'); }
      // Pre-render content for views
      if(key==='nganh-dao-tao') renderMajors();
      if(key==='diem-tuyen-sinh') renderScores();
      if(key==='lien-he') renderDirectory();
      if(key==='su-kien') renderEvents();
      if(key==='ca-nhan') updatePersonal();
      window.scrollTo({top:10000,behavior:'smooth'});
    }

    function switchTab(el, key){
      document.querySelectorAll('.nav a').forEach(a=>a.classList.remove('active'));
      el.classList.add('active');
      if(key && key!=='home') openFeature(key); else {
        // về home: ẩn tất cả view
        VIEWS.forEach(v=>document.getElementById('view-'+v).classList.add('hidden'));
        window.scrollTo({top:0,behavior:'smooth'});
      }
    }

    /* ===== Toast ===== */
    const toastEl = document.getElementById('toast');
    function toast(msg){ toastEl.textContent = msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'), 1600); }

    /* ===== Đăng nhập MSSV ===== */
    function loginMSSV(){
      const mssv = prompt("Nhập MSSV của bạn:");
      if(!mssv) return;
      if(!window.studentList){ alert('Chưa nạp data-sinhvien.js'); return; }
      const sv = studentList.find(s => (s.mssv||'').toLowerCase() === mssv.trim().toLowerCase());
      if(sv){
        localStorage.setItem('sv', JSON.stringify(sv));
        document.getElementById('userName').textContent = sv.name;
        document.getElementById('statusBadge').textContent = sv.name;
        toast(`Xin chào ${sv.name}`);
        updatePersonal();
      } else {
        alert("MSSV không tồn tại trong hệ thống!");
      }
    }

    function logoutMSSV(){
      localStorage.removeItem('sv');
      document.getElementById('userName').textContent = 'Khách !';
      document.getElementById('statusBadge').textContent = 'Khách';
      updatePersonal();
      toast('Đã đăng xuất');
    }

    function updatePersonal(){
      const sv = JSON.parse(localStorage.getItem('upt_user')||'null');
      const pName = document.getElementById('pName');
      const pMeta = document.getElementById('pMeta');
      const sCredit = document.getElementById('sCredit');
      const sGPA = document.getElementById('sGPA');
      const avatar = document.getElementById('');
      if(sv){
        pName.textContent = `${sv.name} (${sv.mssv})`;
        pMeta.textContent = `${sv.major||'—'} · Sinh viên UPT`;
        sCredit.textContent = sv.credits ?? '—';
        sGPA.textContent = sv.gpa ?? '—';
        avatar.textContent = sv.name?.trim()?.charAt(0)?.toUpperCase() || '👤';
      } else {
        pName.textContent = 'Khách';
        pMeta.textContent = 'Chưa đăng nhập · Nhấn “Đăng nhập MSSV”';
        sCredit.textContent = '—';
        sGPA.textContent = '—';
        avatar.textContent = '👤';
      }
    }

    // === BẮT ĐẦU PHẦN CODE SỬA ĐỔI ===
    // Auto restore session if any
    (function init(){
      // Ưu tiên 1: Kiểm tra người dùng đăng nhập bằng Google (key: 'upt_user')
      const googleUserString = localStorage.getItem('upt_user');
      if (googleUserString) {
        try {
          const googleUser = JSON.parse(googleUserString);
          if (googleUser && googleUser.name) {
            // Cập nhật lời chào và badge ở header
            document.getElementById('userName').textContent = googleUser.name;
            document.getElementById('statusBadge').textContent = googleUser.name;
            
            // Cập nhật luôn thông tin ở trang cá nhân
            document.getElementById('pName').textContent = googleUser.name;
            document.getElementById('pMeta').textContent = googleUser.email; // Hiển thị email
            
            // Cập nhật avatar nếu có
            if (googleUser.picture) {
                const avatarEl = document.getElementById('avatar');
                // Thay thế icon bằng ảnh thật
                avatarEl.innerHTML = `<img src="${googleUser.picture}" alt="Avatar" style="width:100%;height:100%;object-fit:cover;border-radius:inherit;">`;
            }
            
            // Đã tìm thấy người dùng Google, không cần kiểm tra tiếp
            return;
          }
        } catch (e) {
          console.error("Lỗi khi đọc dữ liệu Google user từ localStorage", e);
        }
      }

      // Ưu tiên 2: Nếu không có người dùng Google, kiểm tra người dùng MSSV (key: 'sv') - Code gốc
      const sv = JSON.parse(localStorage.getItem('sv')||'null');
      if(sv){
        document.getElementById('userName').textContent = sv.name;
        document.getElementById('statusBadge').textContent = sv.name;
        updatePersonal(); // Hàm này sẽ cập nhật trang cá nhân cho MSSV
      }
    })();
    // === KẾT THÚC PHẦN CODE SỬA ĐỔI ===

  </script>
  <script>
    function clickbotzalo(){
        window.open("https://zalo.me/4086449486138516417?src=qr");
        
      }
    
  </script>
</body>
</html>