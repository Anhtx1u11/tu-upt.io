<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 4 Test v2</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            max-width: 800px;
            width: 100%;
        }
        .quiz-container {
            background: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #1d4ed8;
            text-align: center;
            margin-top: 0;
        }
        .instructions {
            font-size: 1.1em;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        ol {
            padding-left: 25px;
        }
        
        /* --- Styles for Fill in the Blank & Word Formation --- */
        .fill-in-text {
            font-size: 1.2em;
            line-height: 2.5;
        }
        .fill-in-text ol {
            padding-left: 20px;
        }
        .fill-in-text li {
            margin-bottom: 12px;
        }
        .fill-in-text input {
            width: 140px;
            border: none;
            border-bottom: 2px solid #9ca3af;
            font-size: 1em;
            font-family: inherit;
            text-align: center;
            margin: 0 5px;
            padding: 2px 5px;
            transition: border-color 0.3s, box-shadow 0.3s;
            vertical-align: middle;
        }
        .fill-in-text input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 1px 0 #4f46e5;
        }
        .fill-in-text .verb-in-bracket {
            font-family: monospace;
            color: #555;
            font-size: 0.9em;
        }
        .fill-in-text .capitals {
            font-family: monospace;
            color: #555;
            font-size: 0.9em;
            text-transform: uppercase;
        }
        .fill-in-text input.correct {
            border-color: #16a34a;
            background-color: #f0fdf4;
        }
        .fill-in-text input.incorrect {
            border-color: #dc2626;
            background-color: #fef2f2;
        }
        
        /* --- Styles for Multiple Choice --- */
        .mcq-list li { margin-bottom: 15px; font-size: 1.1em; line-height: 1.6;}
        .mcq-options { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 8px; }
        .mcq-option { display: flex; align-items: center; }
        .mcq-option input[type="radio"] { margin-right: 8px; }
        .mcq-option label { cursor: pointer; padding: 4px 8px; border-radius: 5px; transition: background-color 0.3s; }
        .mcq-option label.correct-answer { background-color: #dcfce7; color: #15803d; font-weight: bold; }
        .mcq-option label.incorrect-choice { background-color: #fee2e2; color: #b91c1c; text-decoration: line-through; }
        
        /* --- General Styles --- */
        .check-button { display: block; width: 100%; padding: 12px 20px; font-size: 1.1em; font-weight: bold; color: #fff; background-color: #2563eb; border: none; border-radius: 8px; cursor: pointer; margin-top: 30px; transition: background-color 0.3s; }
        .check-button:hover { background-color: #1d4ed8; }
        .score-display { margin-top: 20px; padding: 10px 15px; font-size: 1.2em; font-weight: bold; text-align: center; border-radius: 8px; display: none; }
        .score-display.correct { background-color: #dcfce7; color: #15803d; }
        .score-display.incorrect { background-color: #fee2e2; color: #b91c1c; }

    </style>
</head>
<body>

<div class="container">
    <h1>Unit 4 Test v2</h1>

    <div class="quiz-container">
        <h2>Vocabulary 1</h2>
        <p class="instructions"><b>Choose the correct option (A, B, C or D) to complete the sentences.</b></p>
        <ol class="mcq-list">
            <li>Some people <span class="mcq-option-inline"></span> themselves difficult challenges in life.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p1-1" value="A" id="u4v2p1-1a"><label for="u4v2p1-1a">A give</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-1" value="B" id="u4v2p1-1b"><label for="u4v2p1-1b">B do</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-1" value="C" id="u4v2p1-1c"><label for="u4v2p1-1c">C take</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-1" value="D" id="u4v2p1-1d"><label for="u4v2p1-1d">D play</label></div></div></li>
            <li>Don't <span class="mcq-option-inline"></span> risks in the mountains when the weather is bad.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p1-2" value="A" id="u4v2p1-2a"><label for="u4v2p1-2a">A do</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-2" value="B" id="u4v2p1-2b"><label for="u4v2p1-2b">B make</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-2" value="C" id="u4v2p1-2c"><label for="u4v2p1-2c">C get</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-2" value="D" id="u4v2p1-2d"><label for="u4v2p1-2d">D take</label></div></div></li>
            <li>Joel is very <span class="mcq-option-inline"></span>-working. He spends a lot of time at work.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p1-3" value="A" id="u4v2p1-3a"><label for="u4v2p1-3a">A strong</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-3" value="B" id="u4v2p1-3b"><label for="u4v2p1-3b">B good</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-3" value="C" id="u4v2p1-3c"><label for="u4v2p1-3c">C hard</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-3" value="D" id="u4v2p1-3d"><label for="u4v2p1-3d">D long</label></div></div></li>
            <li>After spending twenty years in my job, I think I can say I am <span class="mcq-option-inline"></span>.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p1-4" value="A" id="u4v2p1-4a"><label for="u4v2p1-4a">A experienced</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-4" value="B" id="u4v2p1-4b"><label for="u4v2p1-4b">B positive</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-4" value="C" id="u4v2p1-4c"><label for="u4v2p1-4c">C kind</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-4" value="D" id="u4v2p1-4d"><label for="u4v2p1-4d">D intelligent</label></div></div></li>
            <li>What is the biggest <span class="mcq-option-inline"></span> we have to solve today?<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p1-5" value="A" id="u4v2p1-5a"><label for="u4v2p1-5a">A challenger</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-5" value="B" id="u4v2p1-5b"><label for="u4v2p1-5b">B challenge</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-5" value="C" id="u4v2p1-5c"><label for="u4v2p1-5c">C challenging</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-5" value="D" id="u4v2p1-5d"><label for="u4v2p1-5d">D challenged</label></div></div></li>
            <li>Did you <span class="mcq-option-inline"></span> for the exam?<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p1-6" value="A" id="u4v2p1-6a"><label for="u4v2p1-6a">A test</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-6" value="B" id="u4v2p1-6b"><label for="u4v2p1-6b">B memory</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-6" value="C" id="u4v2p1-6c"><label for="u4v2p1-6c">C score</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-6" value="D" id="u4v2p1-6d"><label for="u4v2p1-6d">D study</label></div></div></li>
            <li>We need to find a <span class="mcq-option-inline"></span> to the problem.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p1-7" value="A" id="u4v2p1-7a"><label for="u4v2p1-7a">A solve</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-7" value="B" id="u4v2p1-7b"><label for="u4v2p1-7b">B score</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-7" value="C" id="u4v2p1-7c"><label for="u4v2p1-7c">C solution</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-7" value="D" id="u4v2p1-7d"><label for="u4v2p1-7d">D achievement</label></div></div></li>
            <li>Jill left her bag on the bus but, <span class="mcq-option-inline"></span>, we found it later.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p1-8" value="A" id="u4v2p1-8a"><label for="u4v2p1-8a">A really</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-8" value="B" id="u4v2p1-8b"><label for="u4v2p1-8b">B fortunately</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-8" value="C" id="u4v2p1-8c"><label for="u4v2p1-8c">C while</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-8" value="D" id="u4v2p1-8d"><label for="u4v2p1-8d">D next</label></div></div></li>
            <li>Thanks for buying me flowers on my birthday. That was very <span class="mcq-option-inline"></span> of you.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p1-9" value="A" id="u4v2p1-9a"><label for="u4v2p1-9a">A positive</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-9" value="B" id="u4v2p1-9b"><label for="u4v2p1-9b">B intelligent</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-9" value="C" id="u4v2p1-9c"><label for="u4v2p1-9c">C kind</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-9" value="D" id="u4v2p1-9d"><label for="u4v2p1-9d">D patient</label></div></div></li>
            <li>On our way home, we drove <span class="mcq-option-inline"></span> a tunnel.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p1-10" value="A" id="u4v2p1-10a"><label for="u4v2p1-10a">A across</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-10" value="B" id="u4v2p1-10b"><label for="u4v2p1-10b">B through</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-10" value="C" id="u4v2p1-10c"><label for="u4v2p1-10c">C on</label></div><div class="mcq-option"><input type="radio" name="u4v2p1-10" value="D" id="u4v2p1-10d"><label for="u4v2p1-10d">D onto</label></div></div></li>
        </ol>
        <div id="u4v2p1-results" class="score-display"></div>
        <button id="check-button-u4v2p1" class="check-button">Kiểm tra Vocabulary 1</button>
    </div>

    <div class="quiz-container">
        <h2>Vocabulary 2</h2>
        <p class="instructions"><b>Complete the sentences with the correct form of the word in CAPITAL LETTERS.</b></p>
        <div class="fill-in-text">
            <ol>
                <li>Climbing Mount Kilimanjaro was my greatest personal <input type="text" id="u4v2p2_ans1" data-answer="achievement">. <span class="capitals">ACHIEVE</span></li>
                <li>Hillary and Tenzing were the first <input type="text" id="u4v2p2_ans2" data-answer="mountaineers"> to climb Everest. <span class="capitals">MOUNTAIN</span></li>
                <li>We're trying to find a <input type="text" id="u4v2p2_ans3" data-answer="solution"> to the problem. <span class="capitals">SOLVE</span></li>
                <li>Ollie is trying to <input type="text" id="u4v2p2_ans4" data-answer="memorize"> the capitals of every state in the USA. <span class="capitals">MEMORY</span></li>
                <li>It was a <input type="text" id="u4v2p2_ans5" data-answer="challenging"> journey across snow and ice. <span class="capitals">CHALLENGE</span></li>
                <li>I don't know anybody as kind or as <input type="text" id="u4v2p2_ans6" data-answer="patient"> as Josie. <span class="capitals">PATIENCE</span></li>
                <li>We were lost but, <input type="text" id="u4v2p2_ans7" data-answer="luckily">, we found a path that took us back to the campsite. <span class="capitals">LUCK</span></li>
                <li>Be <input type="text" id="u4v2p2_ans8" data-answer="careful"> when you go down those steps. They're dangerous. <span class="capitals">CARE</span></li>
                <li>Some people think paragliding is safe, but I think it's <input type="text" id="u4v2p2_ans9" data-answer="risky">. <span class="capitals">RISK</span></li>
                <li>Jake is an <input type="text" id="u4v2p2_ans10" data-answer="adventurer">. He travels to dangerous places around the world. <span class="capitals">ADVENTURE</span></li>
            </ol>
        </div>
        <button id="check-button-u4v2p2" class="check-button">Kiểm tra Vocabulary 2</button>
    </div>

    <div class="quiz-container">
        <h2>Grammar 3</h2>
        <p class="instructions"><b>Complete the text with the correct past simple or past continuous form of the verbs in brackets.</b></p>
        <div class="fill-in-text">
            Ellen MacArthur (0) <u><b>was</b></u> <span class="verb-in-bracket">(be)</span> born in Derbyshire in the UK in 1976. She (1)<input type="text" id="u4v2p3_ans1" data-answer="grew"> <span class="verb-in-bracket">(grow)</span> up far from the sea, and her parents and brothers (2)<input type="text" id="u4v2p3_ans2" data-answer="weren't|were not"> <span class="verb-in-bracket">(not be)</span> very interested in sailing. However, she (3)<input type="text" id="u4v2p3_ans3" data-answer="had"> <span class="verb-in-bracket">(have)</span> an aunt who was a yachtswoman and she (4)<input type="text" id="u4v2p3_ans4" data-answer="learned|learnt"> <span class="verb-in-bracket">(learn)</span> to sail while she (5)<input type="text" id="u4v2p3_ans5" data-answer="was staying"> <span class="verb-in-bracket">(stay)</span> with her aunt on the east coast of England. Ellen (6)<input type="text" id="u4v2p3_ans6" data-answer="bought"> <span class="verb-in-bracket">(buy)</span> her first small boat while she (7)<input type="text" id="u4v2p3_ans7" data-answer="was studying"> <span class="verb-in-bracket">(study)</span> at school. After that, she (8)<input type="text" id="u4v2p3_ans8" data-answer="spent"> <span class="verb-in-bracket">(spend)</span> all her free time sailing. In 2005, she (9)<input type="text" id="u4v2p3_ans9" data-answer="became"> <span class="verb-in-bracket">(become)</span> world famous when she (10)<input type="text" id="u4v2p3_ans10" data-answer="broke"> <span class="verb-in-bracket">(break)</span> the world record for the fastest solo circumnavigation of the globe in a yacht.
        </div>
        <button id="check-button-u4v2p3" class="check-button">Kiểm tra Grammar 3</button>
    </div>

    <div class="quiz-container">
        <h2>Grammar 4</h2>
        <p class="instructions"><b>Choose the correct option (A, B, C or D) to complete the sentences.</b></p>
        <ol class="mcq-list">
            <li>We missed the train because it <span class="mcq-option-inline"></span> at the station.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p4-1" value="A" id="u4v2p4-1a"><label for="u4v2p4-1a">A not stop</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-1" value="B" id="u4v2p4-1b"><label for="u4v2p4-1b">B didn't stop</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-1" value="C" id="u4v2p4-1c"><label for="u4v2p4-1c">C wasn't stopping</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-1" value="D" id="u4v2p4-1d"><label for="u4v2p4-1d">D don't stop</label></div></div></li>
            <li>We <span class="mcq-option-inline"></span> tired so we went home.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p4-2" value="A" id="u4v2p4-2a"><label for="u4v2p4-2a">A feel</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-2" value="B" id="u4v2p4-2b"><label for="u4v2p4-2b">B feels</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-2" value="C" id="u4v2p4-2c"><label for="u4v2p4-2c">C feeling</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-2" value="D" id="u4v2p4-2d"><label for="u4v2p4-2d">D felt</label></div></div></li>
            <li>While she <span class="mcq-option-inline"></span> through the country, she visited many interesting places.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p4-3" value="A" id="u4v2p4-3a"><label for="u4v2p4-3a">A was travelling</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-3" value="B" id="u4v2p4-3b"><label for="u4v2p4-3b">B were travelling</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-3" value="C" id="u4v2p4-3c"><label for="u4v2p4-3c">C travelling</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-3" value="D" id="u4v2p4-3d"><label for="u4v2p4-3d">D is travelling</label></div></div></li>
            <li>What <span class="mcq-option-inline"></span> when you saw him?<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p4-4" value="A" id="u4v2p4-4a"><label for="u4v2p4-4a">A was Tom doing</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-4" value="B" id="u4v2p4-4b"><label for="u4v2p4-4b">B were Tom doing</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-4" value="C" id="u4v2p4-4c"><label for="u4v2p4-4c">C Tom was doing</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-4" value="D" id="u4v2p4-4d"><label for="u4v2p4-4d">D Tom were doing</label></div></div></li>
            <li>I <span class="mcq-option-inline"></span> my leg when I fell off the ladder.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p4-5" value="A" id="u4v2p4-5a"><label for="u4v2p4-5a">A break</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-5" value="B" id="u4v2p4-5b"><label for="u4v2p4-5b">B broke</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-5" value="C" id="u4v2p4-5c"><label for="u4v2p4-5c">C am breaking</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-5" value="D" id="u4v2p4-5d"><label for="u4v2p4-5d">D was breaking</label></div></div></li>
            <li><span class="mcq-option-inline"></span> you see the film last Friday?<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p4-6" value="A" id="u4v2p4-6a"><label for="u4v2p4-6a">A Do</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-6" value="B" id="u4v2p4-6b"><label for="u4v2p4-6b">B Was</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-6" value="C" id="u4v2p4-6c"><label for="u4v2p4-6c">C Did</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-6" value="D" id="u4v2p4-6d"><label for="u4v2p4-6d">D Were</label></div></div></li>
            <li>While <span class="mcq-option-inline"></span> watching the match, it started to rain.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p4-7" value="A" id="u4v2p4-7a"><label for="u4v2p4-7a">A we were</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-7" value="B" id="u4v2p4-7b"><label for="u4v2p4-7b">B she were</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-7" value="C" id="u4v2p4-7c"><label for="u4v2p4-7c">C were we</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-7" value="D" id="u4v2p4-7d"><label for="u4v2p4-7d">D were she</label></div></div></li>
            <li>I was hoping to pass the exam but, in the end, I <span class="mcq-option-inline"></span> it.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p4-8" value="A" id="u4v2p4-8a"><label for="u4v2p4-8a">A fail</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-8" value="B" id="u4v2p4-8b"><label for="u4v2p4-8b">B failed</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-8" value="C" id="u4v2p4-8c"><label for="u4v2p4-8c">C was failing</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-8" value="D" id="u4v2p4-8d"><label for="u4v2p4-8d">D am failed</label></div></div></li>
            <li>Fiona and I <span class="mcq-option-inline"></span> get on during the holidays last summer.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p4-9" value="A" id="u4v2p4-9a"><label for="u4v2p4-9a">A don't</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-9" value="B" id="u4v2p4-9b"><label for="u4v2p4-9b">B wasn't</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-9" value="C" id="u4v2p4-9c"><label for="u4v2p4-9c">C weren't</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-9" value="D" id="u4v2p4-9d"><label for="u4v2p4-9d">D didn't</label></div></div></li>
            <li>I <span class="mcq-option-inline"></span> breakfast when the alarm went off. I stopped eating and ran outside.<div class="mcq-options"><div class="mcq-option"><input type="radio" name="u4v2p4-10" value="A" id="u4v2p4-10a"><label for="u4v2p4-10a">A ate</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-10" value="B" id="u4v2p4-10b"><label for="u4v2p4-10b">B was eating</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-10" value="C" id="u4v2p4-10c"><label for="u4v2p4-10c">C eat</label></div><div class="mcq-option"><input type="radio" name="u4v2p4-10" value="D" id="u4v2p4-10d"><label for="u4v2p4-10d">D am eating</label></div></div></li>
        </ol>
        <div id="u4v2p4-results" class="score-display"></div>
        <button id="check-button-u4v2p4" class="check-button">Kiểm tra Grammar 4</button>
    </div>
</div>

<script>
    // --- Generic Function for Fill-in-the-Blank Sections ---
    function checkFillInBlank(partIdPrefix) {
        for (let i = 1; i <= 10; i++) {
            const input = document.getElementById(`${partIdPrefix}_ans${i}`);
            if (input) {
                const userAnswer = input.value.trim().toLowerCase().replace(/\s+/g, ' ');
                const correctAnswers = input.getAttribute('data-answer').toLowerCase().split('|');
                
                input.classList.remove('correct', 'incorrect');
                
                if (correctAnswers.some(answer => answer.trim() === userAnswer)) {
                    input.classList.add('correct');
                } else {
                    input.classList.add('incorrect');
                }
            }
        }
    }

    // --- Generic Function for Multiple Choice Sections ---
    function checkMultipleChoice(partIdPrefix, correctAnswers) {
        let score = 0;
        const totalQuestions = Object.keys(correctAnswers).length;

        for (const questionId in correctAnswers) {
            const correctAnswerValue = correctAnswers[questionId];
            const questionElement = document.querySelector(`li:has(input[name="${questionId}"])`);
            
            questionElement.querySelectorAll('label').forEach(l => l.classList.remove('correct-answer', 'incorrect-choice'));
            
            const correctLabel = questionElement.querySelector(`label[for="${questionId}${correctAnswerValue.toLowerCase()}"]`);
            if(correctLabel) correctLabel.classList.add('correct-answer');
            
            const userAnswerInput = questionElement.querySelector(`input[name="${questionId}"]:checked`);
            if (userAnswerInput) {
                const userAnswerValue = userAnswerInput.value;
                if (userAnswerValue === correctAnswerValue) {
                    score++;
                } else {
                    const userLabel = questionElement.querySelector(`label[for="${userAnswerInput.id}"]`);
                    if(userLabel) userLabel.classList.add('incorrect-choice');
                }
            }
        }
        
        const resultsDiv = document.getElementById(`${partIdPrefix}-results`);
        resultsDiv.textContent = `Bạn đã đúng ${score} / ${totalQuestions} câu!`;
        resultsDiv.style.display = 'block';
        resultsDiv.classList.remove('correct', 'incorrect');
        if (score > totalQuestions / 2) {
             resultsDiv.classList.add('correct');
        } else {
             resultsDiv.classList.add('incorrect');
        }
    }

    // --- Event Listeners ---
    document.getElementById('check-button-u4v2p2').addEventListener('click', () => checkFillInBlank('u4v2p2'));
    document.getElementById('check-button-u4v2p3').addEventListener('click', () => checkFillInBlank('u4v2p3'));

    document.getElementById('check-button-u4v2p1').addEventListener('click', () => {
        const answers = {
            'u4v2p1-1': 'A', 'u4v2p1-2': 'D', 'u4v2p1-3': 'C', 'u4v2p1-4': 'A', 'u4v2p1-5': 'B',
            'u4v2p1-6': 'D', 'u4v2p1-7': 'C', 'u4v2p1-8': 'B', 'u4v2p1-9': 'C', 'u4v2p1-10': 'B'
        };
        checkMultipleChoice('u4v2p1', answers);
    });

    document.getElementById('check-button-u4v2p4').addEventListener('click', () => {
        const answers = {
            'u4v2p4-1': 'B', 'u4v2p4-2': 'D', 'u4v2p4-3': 'A', 'u4v2p4-4': 'A', 'u4v2p4-5': 'B',
            'u4v2p4-6': 'C', 'u4v2p4-7': 'A', 'u4v2p4-8': 'B', 'u4v2p4-9': 'D', 'u4v2p4-10': 'B'
        };
        checkMultipleChoice('u4v2p4', answers);
    });

</script>

</body>
</html>